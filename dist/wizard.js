angular.module("formio.wizard",["formio"]).directive("formioWizard",function(){return{restrict:"E",replace:!0,template:'<div><i ng-show="!wizardLoaded" id="formio-loading" style="font-size: 2em;" class="glyphicon glyphicon-refresh glyphicon-spin"></i><div ng-repeat="alert in formioAlerts" class="alert alert-{{ alert.type }}" role="alert">{{ alert.message }}</div><div class="formio-wizard"></div><ul ng-show="wizardLoaded" class="list-inline"><li><a class="btn btn-default" ng-click="cancel()">Cancel</a></li><li ng-if="currentPage > 0"><a class="btn btn-primary" ng-click="prev()">Previous</a></li><li ng-if="currentPage < (form.components.length - 1)"><a class="btn btn-primary" ng-click="next()">Next</a></li><li ng-if="currentPage >= (form.components.length - 1)"><a class="btn btn-primary" ng-click="submit()">Submit Form</a></li></ul></div>',scope:{src:"=",storage:"="},link:function(e,a){e.wizardLoaded=!1,e.wizardElement=angular.element(".formio-wizard",a)},controller:["$scope","$compile","Formio",function(e,a,r){var o=e.storage?localStorage.getItem(e.storage):!1;o&&(o=angular.fromJson(o)),e.formio=new r(e.src),e.page={},e.form={},e.submission={data:o?o.data:{}},e.currentPage=o?o.page:0;var n=function(){e.wizardLoaded=!1,e.storage&&localStorage.setItem(e.storage,angular.toJson({page:e.currentPage,data:e.submission.data})),e.page.components=e.form.components[e.currentPage].components;var r=angular.element(document.createElement("formio"));e.wizardElement.html(a(r.attr({form:"page",submission:"submission"}))(e)),e.wizardLoaded=!0,e.$emit("wizardPage",e.currentPage)};e.submit=function(){e.formio.saveSubmission(angular.copy(e.submission)).then(function(a){e.storage&&localStorage.setItem(e.storage,""),e.$emit("formSubmission",a)})},e.cancel=function(){e.storage&&localStorage.setItem(e.storage,""),e.submission={data:{}},e.currentPage=0,n()},e.next=function(){e.currentPage>=e.form.components.length-1||(e.currentPage++,n(),e.$emit("wizardNext",e.currentPage))},e.prev=function(){e.currentPage<1||(e.currentPage--,n(),e.$emit("wizardPrev",e.currentPage))},e["goto"]=function(a){0>a||a>=e.form.components.length||(e.currentPage=a,n())},e.$on("wizardGoToPage",function(a,r){e["goto"](r)}),e.formio.loadForm().then(function(a){e.form=a,e.page=angular.copy(a),e.$emit("wizardFormLoad",a),n()})}]}});