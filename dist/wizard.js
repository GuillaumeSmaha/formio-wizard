angular.module("formio.wizard",["formio"]).directive("formioWizard",function(){return{restrict:"E",replace:!0,template:'<div><i ng-show="!wizardLoaded" id="formio-loading" style="font-size: 2em;" class="glyphicon glyphicon-refresh glyphicon-spin"></i><div ng-repeat="alert in formioAlerts" class="alert alert-{{ alert.type }}" role="alert">{{ alert.message }}</div><div class="formio-wizard"></div><ul ng-show="wizardLoaded" class="list-inline"><li><a class="btn btn-default" ng-click="cancel()">Cancel</a></li><li ng-if="currentPage > 0"><a class="btn btn-primary" ng-click="prev()">Previous</a></li><li ng-if="currentPage < (form.components.length - 1)"><button class="btn btn-primary" ng-click="next()">Next</button></li><li ng-if="currentPage >= (form.components.length - 1)"><button class="btn btn-primary" ng-click="submit()">Submit Form</button></li></ul></div>',scope:{src:"=",storage:"=",submission:"="},link:function(e,r){e.wizardLoaded=!1,e.wizardElement=angular.element(".formio-wizard",r)},controller:["$scope","$compile","$element","Formio","FormioScope",function(e,r,o,n,t){var i=e.storage?localStorage.getItem(e.storage):!1;i&&(i=angular.fromJson(i)),e.formio=new n(e.src),e.page={},e.form={},!e.submission&&i&&(e.submission={data:i.data}),e.currentPage=i?i.page:0,e.formioAlerts=[],this.showAlerts=e.showAlerts=function(r){e.formioAlerts=[].concat(r)},e.clear=function(){e.storage&&localStorage.setItem(e.storage,""),e.submission={data:{}},e.currentPage=0};var a=function(){e.currentPage>=e.form.components.length&&e.clear(),e.wizardLoaded=!1,e.storage&&localStorage.setItem(e.storage,angular.toJson({page:e.currentPage,data:e.submission.data})),e.page.components=e.form.components[e.currentPage].components;var o=angular.element(document.createElement("formio"));e.wizardElement.html(r(o.attr({form:"page",submission:"submission",id:"formio-wizard-form"}))(e)),e.wizardLoaded=!0,e.formioAlerts=[],e.$emit("wizardPage",e.currentPage)};e.checkErrors=function(){return e.isValid()?!1:(angular.forEach(o.find('[name="formioFieldForm"]').children(),function(e){var r=angular.element(e).scope(),o=r.formioFieldForm;o[r.component.key]&&(o[r.component.key].$pristine=!1)}),e.formioAlerts.push({type:"danger",message:"Please fix the following errors before proceeding."}),!0)},e.submit=function(){e.checkErrors()||e.formio.saveSubmission(angular.copy(e.submission)).then(function(r){e.storage&&localStorage.setItem(e.storage,""),e.$emit("formSubmission",r)})["catch"](t.onError(e,o))},e.cancel=function(){e.clear(),a()},e.next=function(){e.checkErrors()||e.currentPage>=e.form.components.length-1||(e.currentPage++,a(),e.$emit("wizardNext",e.currentPage))},e.prev=function(){e.currentPage<1||(e.currentPage--,a(),e.$emit("wizardPrev",e.currentPage))},e["goto"]=function(r){0>r||r>=e.form.components.length||(e.currentPage=r,a())},e.isValid=function(){var e=o.find("#formio-wizard-form");if(!e.length)return!1;var r=e.children().scope().formioForm;return r.$valid},e.$on("wizardGoToPage",function(r,o){e["goto"](o)}),e.formio.loadForm().then(function(r){e.form=r,e.page=angular.copy(r),e.$emit("wizardFormLoad",r),a()})}]}});